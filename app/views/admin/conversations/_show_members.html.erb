
<ul class="nav nav-tabs">
  <li role="presentation" class="<%= :active if tab == :chat_messages %>">
    <%= link_to "Messages", chat_messages_admin_conversation_path(conversation), remote: true %>
  </li>
  <li role="presentation" class="<%= :active if tab == :show_members %>">
    <%= link_to "Membres (#{conversation.members_count})", show_members_admin_conversation_path(conversation), remote: true %>
  </li>
</ul>



<table class="table">
  <th>Nom</th>
  <th>Email</th>
  <th>Téléphone</th>
  <th>Membre</th>
  <th>Membre depuis</th>
  <th></th>

  <% conversation.join_requests.each do |join_request| %>
    <% user = join_request.user %>

    <tr>
      <td>
        <%= link_to user.full_name, edit_admin_user_path(user.id) %>
        <% if user == conversation.user %><i>(administrateur)</i><% end %>
      </td>
      <td><%= user.email %></td>
      <td><%= user.phone %></td>
      <td>
        <span class="badge" style="<%= join_request.accepted? ? 'background: green' : "" %>">
          <%= join_request.status %>
        </span>
      </td>
      <td><%= l join_request.created_at, format: :date_long %></td>
      <td>
        <% if join_request.accepted? %>
          <%= button_to "Supprimer", unjoin_admin_conversation_path(conversation.id, user_id: user.id), remote: true, method: :post, class: "btn btn-default btn-sm", form: { style: "display: inline-block" } %></td>
        <% else %>
        <%= button_to "Rejoindre", invite_admin_conversation_path(conversation.id, user_id: user.id), remote: true, method: :post, class: "btn btn-default btn-sm", form: { style: "display: inline-block" } %></td>
      <% end %>
    </tr>
  <% end %>
</table>

<% unless archived_for_user?(@conversation, current_admin) %>
  <%= form_tag invite_admin_conversation_path(@conversation.id), remote: true, method: :post, html: { role: "form" } do |f| %>
    <%= submit_tag "Ajouter à la conversation", class: "btn btn-default btn-sm", style: "float: right" %>

    <%= text_field_tag :user_id, nil, class: "form-control", style: "float: right; width: 200px;", placeholder: "utilisateur (ID ou téléphone)", required: true %>
  <% end %>
<% end %>
