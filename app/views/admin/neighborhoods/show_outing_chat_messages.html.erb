<%= stylesheet_link_tag 'chat_messages' %>

<div class="container">
  <div style="width: 750px; margin: auto">
    <%= render 'edit_header', tab: :show_outing_chat_messages %>

    <div class="row">
      <div class="breadcrumb" style="margin-bottom: 0px">
        <%= "Messages de l'Ã©vÃ©nement : #{@outing.title}" %>
      </div>

      <% color = {} %>

      <% if @chat_messages.empty? %>
        Il n'y a pas encore de message.
      <% else %>
        <% date = nil %>

        <% @chat_messages.each do |message| %>
          <% if date.nil? || date != message.created_at.to_date %>
            <% date = message.created_at.to_date %>
            <div class="conversation-day-divider">
              <div class="conversation-day-divider-label">
                <% if date == Date.today %>
                  aujourd'hui
                <% else %>
                  <%= l date, format: "%A %-d %B %Y" %>
                <% end %>
              </div>
            </div>
          <% end %>

          <% color[message.user_id] ||= (color.count * 0.381966011 * 360).round %>

          <div class="conversation-message">
            <div class="conversation-gutter">
              <div style="background-color: hsl(<%= color[message.user_id] %>, 70%, 75%)" class="conversation-icon">
                <%= [message.user.first_name.try(:first), message.user.last_name.try(:first)].compact.join.upcase %>
              </div>
            </div>
            <div class="conversation-content">
              <div>
                <%= link_to message.user.full_name, admin_user_path(message.user), class: "conversation-sender" %>
                <span class="conversation-timestamp"><%= l message.created_at, format: "%H h %M" %></span>
              </div>

              <%= simple_format message.content %>

              <% if message.children.any? %>
                <div><%= link_to "voir les commentaires", show_post_comments_admin_neighborhood_path(@neighborhood, post_id: message.id) %></div>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>

      <div class="row">
        <%= paginate @chat_messages %>
      </div>

    </div>
  </div>
</div>
