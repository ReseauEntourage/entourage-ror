#!/bin/bash

function try_exec {
  docker-compose exec --env RAILS_ENV=${RAILS_ENV:-development} spring /entrypoint "$@"
}

# try to run the command in the container
try_exec "$@"

# if it fails, try to start the container and retry the command
if [ $? -eq 1 ]; then
  bin/docker/up
  try_exec "$@"
fi
